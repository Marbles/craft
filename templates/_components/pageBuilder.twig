{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
 # Pagebuilder include template
 # -----------------------------
 #
 # This template is used to output HTML for the main content Matrix field.
 #
 # An `entry` variable is expected to be defined.
-#}

{# Load all our blocks with eager loading #}
{% set modules = entry.pageBuilder.level(1).all %}

{% for i, module in modules %}
    {% set children = module.children.with([
        'blockQuote:blockQuotePicker',
        'blockIconText:blockIcon',
        'blockImage:blockImage',
        'blockCta:ctaPicker',
        'blockGallery:blockImage'
    ]).all() %}
    {# Load our component #}
    {% embed '_components/modules/' ~ module.type.handle %}
    	{% block innerModule %}
    		{%- include [
	        	'_components/widgets/' ~ module.type.handle ~ '/' ~ block.type.handle,
	        	'_components/widgets/' ~ block.type.handle 
	        ] -%}
    	{% endblock %}
    {% endembed %}
{% endfor %}
